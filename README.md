# Автоматическое развёртывание окружения Python на удалённом сервере

Для развёртывания ПО применяется библиотека [Fabric](https://www.fabfile.org)
поверх Invoke и Paramiko. Процесс обмена данными с удалённой машиной происходит
по протоколу SSH.

# Использование
Задачи, выполняемые Fabric, располагаются в файле `fabfile.py`. Запуск производится
командой `fab root@server task_name --arg1 val1 --arg2 val2`. Для удобства
написан скрипт PowerShell `fabr.ps`, который считывает параметры подключения к
серверу из файла `settings.json`, а также подставляет имя задачи по умолчанию.

Например:
* `fabr server_alias -s test_scenario.json` - запуск сценария из файла
`test_scenario.json` на сервере с именем `server_alias`

# Задачи Fabric
### main
Задача по умолчанию выполняет сценарий из файла формате JSON или YAML,
передаваемого в качестве аргумента `--scenario [scenario.yaml]`.

Использование:
* `fab root@server main --scenario scenario.yaml`
* `fabr server_alias -s test_scenario.json`


### install-ssh-key
Находит публичный ключ на локальной машине в директории ~/.ssh
и добавляет его в список авторизованных ключей на удалённой машине.

Использование: `fab root@server install-ssh-key`

### internet
Включение/отключение доступа к интернету на сервере. Реализовано через подмену
шлюза по умолчанию. Используется при разработке для моделирования ситуации,
когда на продакшн-сервере отсутствует доступ в интернет.

Использование: `fab root@server internet off`

Аргументы:
* `on` | `off` - включить/выключить доступ к интернету
